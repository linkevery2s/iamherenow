<!DOCTYPE HTML>
<html lang="ja">
<title>今ここ。</title>
<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
	<meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" >
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta property="og:title" content="今ここ。" />
	<meta property="og:type" content="website" />
	<meta property="og:image" content="./img/ogp.jpg" />
	<meta property="og:description" content="このサービスは、自分の居場所を地図上で把握し「今ここ。」と伝えるためのアプリケーションです。災害が発生した時の安否確認、犯罪目撃情報や災害発生箇所の位置情報の共有、友人などとの待ち合わせ、などなど、あらゆる場面で利用できます。" />
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:title" content="今ここ。" />
	<meta name="twitter:image" content="./img/ogp.jpg" />
	<meta name="twitter:description" content="このサービスは、自分の居場所を地図上で把握し「今ここ。」と伝えるためのアプリケーションです。災害が発生した時の安否確認、犯罪目撃情報や災害発生箇所の位置情報の共有、友人などとの待ち合わせ、などなど、あらゆる場面で利用できます。" />
	<meta name="author" content="仁志">
	<meta name="keywords" content="今ここ。,安否確認,位置情報,共有,待ち合わせ,災害対策,犯罪対策"/>
	<link rel="apple-touch-icon" href="./img/apple-touch-icon.png">
	<link rel="shortcut icon" href="./img/apple-touch-icon.png">

	<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js" integrity="sha512-BwHfrr4c9kmRkLw6iXFdzcdWV/PGkVgiIyIWLLlTSXzWQzxuSg4DiQUCpauz/EWjgk5TYQqX/kvn9pG1NpYfqg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" integrity="sha512-Zcn6bjR/8RZbLEpLIeOwNtzREBAJnUKESxces60Mpoj+2okopSAcSUIUOseddDm0cxnGQzxIR7vJgsLZbdLE3w==" crossorigin="anonymous" referrerpolicy="no-referrer" />

	<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-hash/0.2.1/leaflet-hash.min.js" integrity="sha512-0A4MbfuZq5Au9EdpI1S5rUTXlibNBi8CuZ/X3ycwXyZiCjNzpiO9YH6EMqPgzZm6vfNCuZStBQHjnO17nIC0IQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.EasyButton/2.4.0/easy-button.min.js" integrity="sha512-Tndo4y/YJooD/mGXS9D6F1YyBcSyrWnnSWQ5Z9IcKt6bljicjyka9qcP99qMFbQ5+omfOtwwIapv1DjBCZcTJQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.EasyButton/2.4.0/easy-button.css" integrity="sha512-aiVWmB2G8oV+XfHo1CR6hEAxzCl48Lrl3UBzQ6P+BEMkT8qY1tGecdQx6x/X8i9cCVrwQU9ipsOsZlNkRh9n7w==" crossorigin="anonymous" referrerpolicy="no-referrer" />

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />

	<link rel="stylesheet" href="./lib/Control.OSMGeocoder.css" />
	<script src="./lib/Control.OSMGeocoder.js"></script>

	<!-- modal window -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/linkevery2s/sourcecode/modal_window/main.css">
	<script src="https://cdn.jsdelivr.net/gh/linkevery2s/sourcecode/modal_window/main.js"></script>

	<script src="https://code.jquery.com/jquery-3.7.0.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.qrcode/1.0/jquery.qrcode.min.js" integrity="sha512-NFUcDlm4V+a2sjPX7gREIXgCSFja9cHtKPOL1zj6QhnE0vcY695MODehqkaGYTLyL2wxe/wtr4Z49SvqXq12UQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


	<style>
		html, body, #map{
			height: 100%;
			width: 100%;
			padding: 0;
			margin: 0;
			z-index: 0;
		}

		#cross {
			width: 50px;
			height: 50px;
			position: fixed;
			display: block;
			top: 50%;
			left: 50%;
			z-index: 10;
		}

		#img_cross {
			margin-top: -25px;
			margin-left: -25px;
		}

		img{
			cursor: pointer;
		}

		#app{
			cursor: pointer;
			z-index: 1;
		}

		.modal_content{
			background: #ffffff;
			padding: 10px;
			height: 450px !important;
		}

		iframe {
			margin: 0;
			padding: 0;
			border: none;
			top: 50%;
			left: 50%;
			position: absolute;
			transform: translate(-50%, -50%);
			z-index: 1;
			height: 100%;
			width: 100%;
		}

		#qr_c{
			z-index: 1001;
			padding: 15px;
			background: #fff;
			display: none;
			position: fixed;
			top: 50%;
			left: 50%;
			-webkit-transform: translate(-50%, -50%);
			transform: translate(-50%, -50%);
		}

		#link_c{
			z-index: 1001;
			padding: 15px;
			background: #fff;
			display: none;
			position: fixed;
			top: 50%;
			left: 50%;
			-webkit-transform: translate(-50%, -50%);
			transform: translate(-50%, -50%);
			width: 95%;
		}

	</style>

	<script type="module">
		let map;

		onload = async () => {

			/* ベースマップ */
			let basemap = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
				attribution: '© <a href="http://osm.org/copyright">OpenStreetMap</a> contributors | &copy; 仁志, <a href="https://creativecommons.org/licenses/by/4.0/deed.ja" target="_blank">CC BY 4.0</a>',
			});

			map = L.map('map', {
				center: [37.300, 137.800],
				zoomControl: false,
				zoom: 5
			});

			basemap.addTo(map);

			/* ハッシュ値 */
			let hash = new L.Hash(map);

			/* 検索ボックス */
			let option = {
				position: 'topright', 
				text: '検索',
				placeholder: '検索条件キーワード'
			}
			let osmGeocoder = new L.Control.OSMGeocoder(option);
			map.addControl(osmGeocoder);

			/* コントロールボタン */
			L.control.zoom( { position: 'topright' } ).addTo( map );

			/* GPSボタン */
			let ido;
			let keido;
			let gps_get = (position) => {
				ido = position.coords.latitude;
				keido = position.coords.longitude;
				map.setView([ido, keido], 16);

			}

			let gps_error = (error) => {
				alert("エラーが発生したので、現在地を取得できませんでした。");
			}

			let GPS = () =>{
				if (navigator.geolocation) {
					navigator.geolocation.getCurrentPosition(gps_get,gps_error);
				} else {
					alert("エラーが発生したので、現在地を取得できませんでした。");
				}
			}

			let gps_button = L.easyButton('fa-location-arrow', function(){ GPS();}, {position: 'topright'}).addTo( map );

		}

		window.mail = () => {

			let para = location.hash;
			let par = para.split("/");
			let zoom = map.getZoom();
			let url = "https://linkevery2s.github.io/iamherenow/emap.html%23" + zoom + "/" + par[1] + "/" +par[2];
			location.href =  "mailto:?body= %E4%BB%8A%E3%81%93%E3%81%93%E3%80%82 " + url;

		}

		window.line = () =>{

			let para = location.hash;
			let par = para.split("/");
			let zoom = map.getZoom();
			let url = "https://linkevery2s.github.io/iamherenow/emap.html%23" + zoom + "/" + par[1] + "/" +par[2];
			location.href = "line://msg/text/%E4%BB%8A%E3%81%93%E3%81%93%E3%80%82 "+ url;

		}

		window.tw = () =>{

			let para = location.hash;
			let par = para.split("/");
			let zoom = map.getZoom();
			let url = "https://linkevery2s.github.io/iamherenow/emap.html%23" + zoom + "/" + par[1] + "/" +par[2];
			location.href = "https://twitter.com/share?url=" + url + "&text=%E4%BB%8A%E3%81%93%E3%81%93%E3%80%82";

		}

		window.fb = () =>{

			let para = location.hash;
			let par = para.split("/");
			let zoom = map.getZoom();
			let url = "https://linkevery2s.github.io/iamherenow/emap.html%23" + zoom + "/" + par[1] + "/" +par[2];
			location.href = "https://www.facebook.com/sharer/sharer.php?u=" + url;

		}

		window.qr = () =>{

			$("#qrcode").empty();

			let para = location.hash;
			let par = para.split("/");
			let zoom = map.getZoom();

			let qr_url = "https://linkevery2s.github.io/iamherenow/emap.html#" + zoom + "/" + par[1] + "/" +par[2];

			jQuery('#qrcode').qrcode({
				text: qr_url
			});	

			display();
			$("#exp").hide();
			$("#link_c").hide();
			$("#qr_c").show();

		}

		window.display2 = () =>{

			$("#qr_c").hide();
			$("#link_c").hide();

			document.querySelector('#exp').innerHTML = '<iframe width="100%" src="kaisetu.html"></iframe>';

			$("#exp").show();

			display();

		}

		window.link = () =>{

			$("#qr_c").hide();
			$("#exp").hide();

			let para = location.hash;
			let par = para.split("/");
			let zoom = map.getZoom();
			let url = "https://linkevery2s.github.io/iamherenow/emap.html#" + zoom + "/" + par[1] + "/" +par[2];

			document.querySelector('#link_url').innerHTML = url;

			$("#link_c").show();

			display();


		}


	</script>
	<script src="https://cdn.tailwindcss.com"></script>

</head>

<body>

	<!-- map -->
	<div id='map'></div>	

	<div id="app" class="fixed top-0 mt-2 ml-2 p-2 bg-white rounded-md left-0 border-solid border-2 border-indigo-600" onclick="display2();">このアプリについて</div>

	<!-- cross_key -->
	<div id ="cross">
		<img id ="img_cross" src="./img/cross.png">
	</div>

	<!-- share button -->
	<div class="left-1/2 -translate-x-1/2 fixed bottom-0 mb-12 p-2 bg-white rounded-md right-0 border-double border-4 border-indigo-600 grid gap-1 grid-cols-6 grid-rows-1 w-80 shadow-lg">

		<img src="./img/line.png" width="50px" onclick="line();">
		<img src="./img/tw.png" width="50px" onclick="tw();">
		<img src="./img/fb.png" width="50px" onclick="fb();">
		<img src="./img/mail.png" class="rounded" width="50px" onclick="mail();">
		<img src="./img/link.png" class="rounded" width="50px" onclick="link();">
		<img src="./img/qr.png" width="50px" onclick="qr();">

	</div>

	<!-- modal window -->
	<div class="modal js-modal">
		<div class="modal_bg" onClick="closed()"></div>
		<div class="modal_content -mt-8 md:mt-0"><span class="closed" onClick="closed()">×</span>

			<span id="exp"></span>

			<div id ="qr_c"><span id ="qrcode"></span></div>

			<div id="link_c">
				
				
<label for="message" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">URL</label>
<textarea id="link_url" onfocus="this.select();" rows="3" class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"></textarea>

				↑のURLをコピーし、送信するアプリ（SNSやメールなど）に貼り付けて、送信してください。

			</div>

		</div>

	</div>



</body>
</html>
